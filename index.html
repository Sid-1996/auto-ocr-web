<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨è‡ªå‹•åœ–ç‰‡æ–‡å­—è­˜åˆ¥å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: #4e54c8;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .upload-area {
            border: 3px dashed #4e54c8;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .upload-area:hover, .upload-area.dragover {
            background: #eef0ff;
            border-color: #ff6b6b;
        }
        
        .upload-area i {
            font-size: 64px;
            color: #4e54c8;
            margin-bottom: 20px;
        }
        
        .upload-area h3 {
            font-size: 24px;
            color: #4e54c8;
            margin-bottom: 15px;
        }
        
        .upload-area p {
            color: #666;
            margin: 8px 0;
            font-size: 16px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: #4e54c8;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 15px 0;
            transition: all 0.3s;
        }
        
        .upload-btn:hover {
            background: #3a3eb3;
        }
        
        .language-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .lang-btn {
            padding: 8px 15px;
            border: 2px solid #4e54c8;
            border-radius: 20px;
            background: white;
            color: #4e54c8;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .lang-btn.active {
            background: #4e54c8;
            color: white;
        }
        
        .processing-area {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            text-align: center;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4e54c8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-text {
            font-size: 18px;
            color: #4e54c8;
            font-weight: 600;
        }
        
        .result-area {
            display: none;
            flex-direction: column;
            gap: 20px;
        }
        
        .result-title {
            font-size: 20px;
            color: #333;
            font-weight: 600;
            text-align: center;
        }
        
        .text-output {
            background: #f8f9ff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #4e54c8;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #3a3eb3;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-new {
            background: #00b894;
        }
        
        .btn-new:hover {
            background: #009e7d;
        }
        
        .hint {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #00b894;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .status-bar {
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .status-progress {
            height: 100%;
            background: linear-gradient(90deg, #4e54c8, #8f94fb);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .debug-info {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            display: block;
            text-align: left;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 12px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
            
            .language-selector {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å…¨è‡ªå‹•åœ–ç‰‡æ–‡å­—è­˜åˆ¥å·¥å…·</h1>
            <p class="description">æ”¯æ´æ‹–æ”¾ã€è²¼ä¸Šåœ–ç‰‡æˆ–ä¸Šå‚³æª”æ¡ˆï¼Œè‡ªå‹•è­˜åˆ¥ä¸¦è¤‡è£½æ–‡å­—å…§å®¹</p>
        </header>
        
        <div class="main-content">
            <div class="upload-area" id="uploadArea">
                <i>ğŸ“‹</i>
                <h3>å¤šç¨®æ–¹å¼ä¸Šå‚³åœ–ç‰‡</h3>
                <p>ä½¿ç”¨ Ctrl+V è²¼ä¸Šåœ–ç‰‡</p>
                <p>ç›´æ¥æ‹–æ”¾åœ–ç‰‡åˆ°æ­¤å€åŸŸ</p>
                <p>æˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æª”æ¡ˆ</p>
                
                <input type="file" class="file-input" id="fileInput" accept="image/*">
                <button class="upload-btn" id="uploadBtn">é¸æ“‡åœ–ç‰‡æª”æ¡ˆ</button>
                
                <div class="language-selector">
                    <div class="lang-btn active" data-lang="eng">è‹±æ–‡</div>
                    <div class="lang-btn" data-lang="chi_sim">ä¸­æ–‡</div>
                </div>
                
                <p class="hint">æ”¯æ´æ ¼å¼: JPG, PNG, GIF, BMP</p>
                <p class="hint">è­˜åˆ¥å®Œæˆå¾Œæ–‡å­—å°‡è‡ªå‹•è¤‡è£½åˆ°å‰ªè²¼ç°¿</p>
                <div class="debug-info" id="debugInfo">ç³»çµ±æº–å‚™ä¸­...</div>
            </div>
            
            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <div class="progress-text" id="progressText">æ­£åœ¨è™•ç†åœ–ç‰‡ä¸¦æå–æ–‡å­—...</div>
                <div class="status-bar">
                    <div class="status-progress" id="statusProgress"></div>
                </div>
            </div>
            
            <div class="result-area" id="resultArea">
                <h3 class="result-title">å·²è­˜åˆ¥ä¸¦è‡ªå‹•è¤‡è£½çš„æ–‡å­—å…§å®¹</h3>
                <div class="text-output" id="textOutput"></div>
                <div class="action-buttons">
                    <button class="btn" id="copyBtn">
                        <span>é‡æ–°è¤‡è£½æ–‡å­—</span>
                    </button>
                    <button class="btn btn-new" id="newImageBtn">
                        <span>è™•ç†æ–°åœ–ç‰‡</span>
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© å…¨è‡ªå‹•åœ–ç‰‡æ–‡å­—è­˜åˆ¥å·¥å…· | ä½¿ç”¨ Tesseract.js é–‹æºæŠ€è¡“</p>
            <p style="font-size: 12px; color: #999; margin-top: 5px;">æœ¬å·¥å…·åŸºæ–¼å…è²»é–‹æºæŠ€è¡“ï¼Œä¸­æ–‡è­˜åˆ¥ç²¾æº–åº¦å¯èƒ½ä¸å¦‚å•†æ¥­ä»˜è²»æœå‹™</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        æ–‡å­—å·²è‡ªå‹•è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼
    </div>

    <!-- ä½¿ç”¨æœ€æ–°ç©©å®šç‰ˆæœ¬çš„ Tesseract.js -->
    <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>
    
    <script>
        let worker = null;
        let selectedLanguage = 'eng';
        let extractedText = '';
        let isWorkerReady = false;
        
        // DOM å…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const processingArea = document.getElementById('processingArea');
        const resultArea = document.getElementById('resultArea');
        const textOutput = document.getElementById('textOutput');
        const newImageBtn = document.getElementById('newImageBtn');
        const copyBtn = document.getElementById('copyBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const notification = document.getElementById('notification');
        const progressText = document.getElementById('progressText');
        const statusProgress = document.getElementById('statusProgress');
        const langButtons = document.querySelectorAll('.lang-btn');
        const debugInfo = document.getElementById('debugInfo');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            initializeApp();
            setupEventListeners();
        });
        
        function log(message) {
            console.log(message);
            debugInfo.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
        
        async function initializeApp() {
            try {
                log('æ­£åœ¨åˆå§‹åŒ– Tesseract.js...');
                
                // å‰µå»º worker
                worker = await Tesseract.createWorker({
                    logger: m => {
                        if (m.status) {
                            log(`ç‹€æ…‹: ${m.status} - ${Math.round(m.progress * 100)}%`);
                            updateProgress(m);
                        }
                    }
                });
                
                log('Worker å‰µå»ºæˆåŠŸï¼Œæ­£åœ¨è¼‰å…¥èªè¨€åŒ…...');
                
                // è¼‰å…¥è‹±æ–‡èªè¨€åŒ…ï¼ˆæœ€åŸºæœ¬ä¸”æœ€ç©©å®šçš„ï¼‰
                await worker.loadLanguage('eng');
                await worker.initialize('eng');
                
                log('åˆå§‹åŒ–å®Œæˆï¼ç³»çµ±æº–å‚™å°±ç·’ã€‚');
                isWorkerReady = true;
                showNotification('ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥é–‹å§‹ä½¿ç”¨ï¼');
                
            } catch (error) {
                log(`åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
                showNotification('åˆå§‹åŒ–å¤±æ•—ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ç„¡æ³•ä½¿ç”¨', true);
                console.error('Initialization error:', error);
            }
        }
        
        function setupEventListeners() {
            // æª”æ¡ˆé¸æ“‡
            uploadBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
            
            // é»æ“Šä¸Šå‚³å€åŸŸ
            uploadArea.addEventListener('click', (e) => {
                if (!e.target.closest('.lang-btn') && !e.target.closest('.upload-btn')) {
                    fileInput.click();
                }
            });
            
            // æ‹–æ”¾
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            // è²¼ä¸Š
            document.addEventListener('paste', handlePaste);
            
            // èªè¨€é¸æ“‡
            langButtons.forEach(btn => {
                btn.addEventListener('click', handleLanguageChange);
            });
            
            // æŒ‰éˆ•
            newImageBtn.addEventListener('click', resetUI);
            copyBtn.addEventListener('click', () => {
                if (extractedText) {
                    copyToClipboard(extractedText);
                }
            });
        }
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight() {
            uploadArea.classList.add('dragover');
        }
        
        function unhighlight() {
            uploadArea.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        function handlePaste(e) {
            log('æª¢æ¸¬åˆ°è²¼ä¸Šæ“ä½œ');
            
            const clipboardData = e.clipboardData || window.clipboardData;
            if (!clipboardData) {
                log('ç„¡æ³•å­˜å–å‰ªè²¼ç°¿');
                return;
            }
            
            // æª¢æŸ¥æª”æ¡ˆ
            if (clipboardData.files && clipboardData.files.length > 0) {
                const file = clipboardData.files[0];
                log(`å¾å‰ªè²¼ç°¿å–å¾—æª”æ¡ˆ: ${file.name}, é¡å‹: ${file.type}`);
                if (file.type.startsWith('image/')) {
                    e.preventDefault();
                    handleFile(file);
                    return;
                }
            }
            
            // æª¢æŸ¥ items
            if (clipboardData.items) {
                for (let i = 0; i < clipboardData.items.length; i++) {
                    const item = clipboardData.items[i];
                    if (item.type.startsWith('image/')) {
                        log(`å¾å‰ªè²¼ç°¿å–å¾—åœ–ç‰‡é …ç›®: ${item.type}`);
                        const blob = item.getAsFile();
                        if (blob) {
                            e.preventDefault();
                            handleFile(blob);
                            return;
                        }
                    }
                }
            }
            
            log('å‰ªè²¼ç°¿ä¸­æ²’æœ‰æ‰¾åˆ°åœ–ç‰‡');
            showNotification('è«‹å…ˆè¤‡è£½åœ–ç‰‡åˆ°å‰ªè²¼ç°¿', true);
        }
        
        async function handleLanguageChange(e) {
            const newLang = e.target.getAttribute('data-lang');
            
            langButtons.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            
            selectedLanguage = newLang;
            log(`åˆ‡æ›èªè¨€åˆ°: ${selectedLanguage}`);
            
            // å¦‚æœåˆ‡æ›åˆ°ä¸­æ–‡ï¼Œéœ€è¦é‡æ–°è¼‰å…¥èªè¨€åŒ…
            if (newLang.includes('chi') && worker) {
                try {
                    showNotification(`æ­£åœ¨è¼‰å…¥ ${e.target.textContent} èªè¨€åŒ…...`);
                    log(`é–‹å§‹è¼‰å…¥ ${newLang} èªè¨€åŒ…...`);
                    
                    await worker.loadLanguage(newLang);
                    await worker.initialize(newLang);
                    
                    log(`${newLang} èªè¨€åŒ…è¼‰å…¥æˆåŠŸ`);
                    showNotification(`${e.target.textContent} èªè¨€åŒ…è¼‰å…¥å®Œæˆï¼`);
                } catch (error) {
                    log(`èªè¨€åŒ…è¼‰å…¥å¤±æ•—: ${error.message}`);
                    showNotification(`${e.target.textContent} èªè¨€åŒ…è¼‰å…¥å¤±æ•—`, true);
                }
            } else {
                showNotification(`å·²åˆ‡æ›åˆ° ${e.target.textContent} æ¨¡å¼`);
            }
        }
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showNotification('è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆï¼', true);
                return;
            }
            
            log(`é–‹å§‹è™•ç†æª”æ¡ˆ: ${file.name} (${(file.size/1024).toFixed(1)}KB)`);
            
            // åˆ‡æ›åˆ°è™•ç†ç•Œé¢
            uploadArea.style.display = 'none';
            processingArea.style.display = 'flex';
            resultArea.style.display = 'none';
            
            processImage(file);
        }
        
        async function processImage(file) {
            try {
                statusProgress.style.width = '0%';
                
                // å¦‚æœ worker é‚„æ²’æº–å‚™å¥½ï¼Œå…ˆå‰µå»ºä¸€å€‹è‡¨æ™‚çš„
                if (!isWorkerReady || !worker) {
                    log('Worker é‚„æ²’æº–å‚™å¥½ï¼Œå‰µå»ºè‡¨æ™‚ worker...');
                    progressText.textContent = 'æ­£åœ¨æº–å‚™è­˜åˆ¥å¼•æ“...';
                    
                    worker = await Tesseract.createWorker({
                        logger: m => updateProgress(m)
                    });
                    
                    // è¼‰å…¥å°æ‡‰èªè¨€åŒ…
                    await worker.loadLanguage(selectedLanguage);
                    await worker.initialize(selectedLanguage);
                }
                
                // ç¢ºä¿èªè¨€åŒ…å·²è¼‰å…¥
                if (selectedLanguage !== 'eng') {
                    log(`ç¢ºèªèªè¨€åŒ…è¼‰å…¥ç‹€æ…‹: ${selectedLanguage}`);
                    progressText.textContent = `ç¢ºèª ${selectedLanguage} èªè¨€åŒ…...`;
                    
                    try {
                        // é‡æ–°åˆå§‹åŒ–ä»¥ç¢ºä¿èªè¨€åŒ…æ­£ç¢ºè¼‰å…¥
                        await worker.reinitialize(selectedLanguage);
                        log(`èªè¨€åŒ… ${selectedLanguage} ç¢ºèªå®Œæˆ`);
                    } catch (langError) {
                        log(`èªè¨€åŒ…å•é¡Œï¼Œå˜—è©¦é‡æ–°è¼‰å…¥: ${langError.message}`);
                        await worker.loadLanguage(selectedLanguage);
                        await worker.initialize(selectedLanguage);
                    }
                }
                
                log(`é–‹å§‹è­˜åˆ¥æ–‡å­—ï¼Œä½¿ç”¨èªè¨€: ${selectedLanguage}`);
                progressText.textContent = 'æ­£åœ¨è­˜åˆ¥åœ–ç‰‡ä¸­çš„æ–‡å­—...';
                
                // é‡å°ä¸­æ–‡é€²è¡Œç‰¹æ®Šè™•ç†
                const ocrOptions = {};
                if (selectedLanguage.includes('chi')) {
                    // ä¸­æ–‡è­˜åˆ¥çš„ç‰¹æ®Šè¨­å®š
                    ocrOptions.tessedit_char_whitelist = '';
                    ocrOptions.tessedit_pageseg_mode = 1; // è‡ªå‹•é é¢åˆ†å‰²
                    log('ä½¿ç”¨ä¸­æ–‡è­˜åˆ¥å„ªåŒ–è¨­å®š');
                }
                
                // é€²è¡Œ OCR è­˜åˆ¥
                const result = await worker.recognize(file, selectedLanguage, ocrOptions);
                
                log(`è­˜åˆ¥å®Œæˆï¼Œä¿¡å¿ƒåº¦: ${result.data.confidence.toFixed(2)}%`);
                
                extractedText = result.data.text ? result.data.text.trim() : '';
                
                if (extractedText) {
                    log(`æˆåŠŸè­˜åˆ¥åˆ° ${extractedText.length} å€‹å­—å…ƒ`);
                } else {
                    let errorMsg = 'ç„¡æ³•å¾åœ–ç‰‡ä¸­è­˜åˆ¥åˆ°æ–‡å­—å…§å®¹ã€‚\n\nå¯èƒ½çš„åŸå› ï¼š\nâ€¢ åœ–ç‰‡ä¸­æ²’æœ‰æ–‡å­—\nâ€¢ æ–‡å­—å¤ªå°æˆ–æ¨¡ç³Š';
                    
                    if (selectedLanguage.includes('chi')) {
                        errorMsg += '\nâ€¢ ä¸­æ–‡å­—é«”è¤‡é›œæˆ–æ‰‹å¯«å­—é›£ä»¥è­˜åˆ¥\nâ€¢ åœ–ç‰‡è§£æåº¦ä¸è¶³\nâ€¢ Tesseract.js å°ä¸­æ–‡è­˜åˆ¥ç²¾æº–åº¦æœ‰é™\n\nå»ºè­°ï¼š\nâ€¢ ä½¿ç”¨é«˜è§£æåº¦å°åˆ·é«”åœ–ç‰‡\nâ€¢ ç¢ºä¿åœ–ç‰‡æ¸…æ™°ä¸”å°æ¯”åº¦é«˜\nâ€¢ é¿å…å‚¾æ–œæˆ–è®Šå½¢çš„æ–‡å­—\nâ€¢ è€ƒæ…®ä½¿ç”¨å•†æ¥­ OCR æœå‹™ä»¥ç²å¾—æ›´é«˜ç²¾æº–åº¦';
                    } else {
                        errorMsg += '\nâ€¢ èªè¨€è¨­å®šä¸æ­£ç¢º\n\nå»ºè­°ï¼š\nâ€¢ ä½¿ç”¨æ›´æ¸…æ™°çš„åœ–ç‰‡\nâ€¢ å˜—è©¦ä¸åŒçš„èªè¨€è¨­å®š\nâ€¢ ç¢ºä¿åœ–ç‰‡å°æ¯”åº¦è¶³å¤ ';
                    }
                    
                    extractedText = errorMsg;
                    log('æœªè­˜åˆ¥åˆ°æ–‡å­—å…§å®¹');
                }
                
                textOutput.textContent = extractedText;
                
                // è¤‡è£½åˆ°å‰ªè²¼ç°¿
                await copyToClipboard(extractedText);
                
                // é¡¯ç¤ºçµæœ
                processingArea.style.display = 'none';
                resultArea.style.display = 'flex';
                
            } catch (error) {
                log(`è™•ç†å¤±æ•—: ${error.message}`);
                console.error('OCR error:', error);
                
                let errorMsg = `è™•ç†å¤±æ•—ï¼š${error.message}\n\n`;
                
                if (selectedLanguage.includes('chi')) {
                    errorMsg += 'ä¸­æ–‡è­˜åˆ¥å¸¸è¦‹å•é¡Œï¼š\nâ€¢ Tesseract.js å°ä¸­æ–‡è­˜åˆ¥ç²¾æº–åº¦æœ‰æŠ€è¡“é™åˆ¶\nâ€¢ èªè¨€åŒ…è¼‰å…¥å¤±æ•—\nâ€¢ ç¶²è·¯é€£ç·šå•é¡Œ\nâ€¢ åœ–ç‰‡æ ¼å¼ä¸æ”¯æ´\n\nè«‹å˜—è©¦ï¼š\nâ€¢ ä½¿ç”¨æ›´æ¸…æ™°çš„é«˜è§£æåº¦å°åˆ·é«”åœ–ç‰‡\nâ€¢ é‡æ–°é¸æ“‡ä¸­æ–‡èªè¨€\nâ€¢ ç¢ºä¿ç¶²è·¯é€£ç·šç©©å®š\nâ€¢ é‡æ–°æ•´ç†é é¢\nâ€¢ å¦‚éœ€é«˜ç²¾æº–åº¦ï¼Œå»ºè­°ä½¿ç”¨å•†æ¥­ OCR æœå‹™';
                } else {
                    errorMsg += 'è«‹å˜—è©¦ï¼š\nâ€¢ é‡æ–°æ•´ç†é é¢\nâ€¢ ä½¿ç”¨å…¶ä»–åœ–ç‰‡\nâ€¢ æª¢æŸ¥ç¶²è·¯é€£ç·š';
                }
                
                extractedText = errorMsg;
                textOutput.textContent = extractedText;
                
                processingArea.style.display = 'none';
                resultArea.style.display = 'flex';
                
                showNotification('è™•ç†å¤±æ•—ï¼Œè«‹é‡è©¦', true);
            }
        }
        
        function updateProgress(message) {
            if (message.status === 'recognizing text') {
                progressText.textContent = `æ­£åœ¨è­˜åˆ¥æ–‡å­—... ${Math.round(message.progress * 100)}%`;
                statusProgress.style.width = `${message.progress * 100}%`;
            } else if (message.status === 'loading tesseract core') {
                progressText.textContent = 'è¼‰å…¥è­˜åˆ¥æ ¸å¿ƒ...';
                statusProgress.style.width = '20%';
            } else if (message.status === 'initializing tesseract') {
                progressText.textContent = 'åˆå§‹åŒ–è­˜åˆ¥å¼•æ“...';
                statusProgress.style.width = '40%';
            } else if (message.status === 'loading language traineddata') {
                progressText.textContent = 'è¼‰å…¥èªè¨€è³‡æ–™...';
                statusProgress.style.width = '60%';
            } else if (message.status === 'initializing api') {
                progressText.textContent = 'åˆå§‹åŒ– API...';
                statusProgress.style.width = '80%';
            }
        }
        
        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                    showNotification('æ–‡å­—å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                } else {
                    // å‚™ç”¨æ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        showNotification('æ–‡å­—å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                    } else {
                        throw new Error('Copy command failed');
                    }
                }
            } catch (err) {
                log(`è¤‡è£½å¤±æ•—: ${err.message}`);
                showNotification('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡ä¸¦è¤‡è£½', true);
            }
        }
        
        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.style.background = isError ? '#ff6b6b' : '#00b894';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, isError ? 5000 : 3000);
        }
        
        function resetUI() {
            uploadArea.style.display = 'flex';
            processingArea.style.display = 'none';
            resultArea.style.display = 'none';
            textOutput.textContent = '';
            extractedText = '';
            statusProgress.style.width = '0%';
            fileInput.value = '';
            log('ç•Œé¢å·²é‡è¨­ï¼Œæº–å‚™è™•ç†æ–°åœ–ç‰‡');
        }
    </script>
</body>
</html>